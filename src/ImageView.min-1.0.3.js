(function(){function isType(obj,name){return Object.prototype.toString.call(obj).toLowerCase()=='[object '+name.toLowerCase()+']'};HTMLElement.prototype.hasClass=function(name){var c=this.className.split(' ');for(var i=c.length-1;i>=0;i--){if(c[i].toLowerCase()==name.toLowerCase()){return true}}return false};HTMLElement.prototype.addClass=function(name){var list1=name.split(' ');var list2=this.className.split(' ');list1.forEach(function(item,i){var index=list2.indexOf(item);if(index===-1){list2.push(item)}});this.className=list2.join(' ');return this};HTMLElement.prototype.removeClass=function(name){var list1=name.split(' ');var list2=this.className.split(' ');list1.forEach(function(item){var index=list2.indexOf(item);if(index>-1){list2.splice(index,1)}});this.className=list2.join(' ');return this};HTMLElement.prototype.remove=function(){this.parentNode.removeChild(this);return this};HTMLElement.prototype.getComputedStyle=function(name,pseudoElt){var res;var style=getComputedStyle(this,pseudoElt);if(res=/^([0-9.%]+)[^0-9.%]+$/.exec(style[name])){return Number(res[1])}return style[name]};var browsersCompatible=['transform','transition','animation','clipPath'];HTMLElement.prototype.css=function(json){for(var name in json){var index=browsersCompatible.indexOf(name);if(index>-1){var n=name.replace(/^([a-z])/,name[0].toUpperCase());this.style['webkit'+n]=json[name]}this.style[name]=json[name]}return this};Array.prototype.indexOf2=function(value,property){var list=property&&property.split('.');var length=(list&&list.length)||0;var index=-1;var temporary;for(var i=0;i<this.length;i++){var temporary=this[i];for(var z=0;z<length;z++){if(typeof temporary==='object'||typeof temporary==='function'){if(list[z]!==''){temporary=temporary[list[z]]}}else{temporary=null;break}}if(temporary===value){return i}}return index};CanvasRenderingContext2D.prototype.radiusRect=function(width,height,r1,r2,r3,r4){var s=this;s.beginPath();s.moveTo(0,height-r1);s.arcTo(0,0,width,0,r1);s.arcTo(width,0,width,height,r2);s.arcTo(width,height,0,height,r4);s.arcTo(0,height,0,0,r3);s.closePath();return s};var Listeners=function(){var s=this;s.publicName1='__ListenersisRegistered__';s.publicName2='__ListenersCallbackList__'};Listeners.prototype.register=function(object){var s=this;if(!object[s.publicName1]){object[s.publicName1]=true;object[s.publicName2]=object[s.publicName2]||{};object.dispatchEvent=s.dispatchEvent.bind(object);object.on=object.addEventListener=s.addEventListener.bind(object);object.off=object.removeEventListener=s.removeEventListener.bind(object)}};Listeners.prototype.remove=function(object){var s=this;object[s.publicName1]=false;object[s.publicName2]=null;object.dispatchEvent=null;object.on=object.addEventListener=null;object.off=object.removeEventListener=null};Listeners.prototype.dispatchEvent=function(type,data,phase){var s=this;phase=phase||1;type=type.toLowerCase();if(s[Listeners.publicName2][phase]){var list=s[Listeners.publicName2][phase][type];if(list){list.forEach(function(item){item.call(s,data)})}}var typeName=type.toLowerCase().replace(/^([a-z])/g,type[0].toUpperCase());if(s['on'+typeName]&&isType(s['on'+typeName],'function')){s['on'+typeName].call(s,data)}};Listeners.prototype.addEventListener=function(type,callback,phase){var s=this;phase=phase||1;type=type.toLowerCase();s[Listeners.publicName2][phase]=s[Listeners.publicName2][phase]||{};s[Listeners.publicName2][phase][type]=s[Listeners.publicName2][phase][type]||[];s[Listeners.publicName2][phase][type].push(callback)};Listeners.prototype.removeEventListener=function(type,callback,phase){var s=this;phase=phase||1;type=type.toLowerCase();if(s[Listeners.publicName2][phase]&&s[Listeners.publicName2][phase][type]){var list=s[Listeners.publicName2][phase][type];if(typeof callback==='string'&&callback.toLowerCase()==='all'){list.length=0}else{var i=list.indexOf(callback);if(i!==-1){list.splice(i,1)}}}};Listeners=new Listeners();function SpeedDecay(from,speed){var s=this;s.fromValue={};s.currValue={};s.initSpeed={};s.friction=.9;s.minSpeed=.5;s.state='idle';s._nodeTime=0;s._nodeValue={};s._nodeSpeed=null;s._pauseTimesTamp=0;s._DataUpdateTimer=null;s.start=s.start.bind(s);s.init(from);Listeners.register(s)};SpeedDecay.prototype.init=function(from){var s=this;s.state='idle';s.fromValue=from||{};s._nodeTime=Date.now();s._nodeValue={};for(var name in s.fromValue){s._nodeValue[name]=s.fromValue[name]}};SpeedDecay.prototype.start=function(){var s=this;if(s.state!=='pauseing'){s.state='running';s._DataUpdateTimer=requestAnimationFrame(s.start);var currSpeed=0;var currValue={};var currTime=Date.now()-s._nodeTime;if(s._nodeSpeed===null){s._nodeSpeed=s.initSpeed}if(currTime<100){currSpeed=currTime/100*s._nodeSpeed}else{for(var name in s.fromValue){if(s.fromValue.hasOwnProperty(name)){s._nodeValue[name]+=s._nodeSpeed}}s._nodeTime+=100;s._nodeSpeed*=s.friction;currSpeed=(currTime-100)/100*s._nodeSpeed}for(var name in s.fromValue){if(s.fromValue.hasOwnProperty(name)){currValue[name]=s._nodeValue[name]+currSpeed}}s.dispatchEvent('update',currValue);if(Math.abs(s._nodeSpeed)<=s.minSpeed){s.stopTimer();s.dispatchEvent('complete')}}};SpeedDecay.prototype.pause=function(){var s=this;if(s.state==='running'){s.stopTimer();s.state='pauseing';s._pauseTimesTamp=Date.now()}else if(s.state==='pauseing'){s.state='running';s._nodeTime+=Date.now()-s._pauseTimesTamp;s.start()}};SpeedDecay.prototype.stopTimer=function(){var s=this;s.state='idle';s._nodeSpeed=null;cancelAnimationFrame(s._DataUpdateTimer)};function Animation(from,to){var s=this;s.fromList={};s.toList={};s.startTime=0;s.duration=1000;s.state='idle';s._pauseTimesTamp=null;s._DataUpdateTimer=null;s.start=s.start.bind(s);s.init(from,to);Listeners.register(s)};Animation.prototype.init=function(from,to){var s=this;s.state='idle';s.fromList=from||{};s.toList=to||{};s.startTime=Date.now()};Animation.prototype.start=function(){var s=this;var res={};var currTime=Date.now()-s.startTime;if(s.state!=='pauseing'){s.state='running';s._DataUpdateTimer=requestAnimationFrame(s.start);if(currTime<s.duration){for(var name in s.fromList){if(s.fromList.hasOwnProperty(name)){res[name]=s.easing(currTime,s.fromList[name],s.toList[name]-s.fromList[name],s.duration)}}s.dispatchEvent('update',res)}else{s.stopTimer();s.dispatchEvent('update',s.toList);s.dispatchEvent('complete')}}};Animation.prototype.pause=function(){var s=this;if(s.state==='running'){s.stopTimer();s.state='pauseing';s._pauseTimesTamp=Date.now()}else if(s.state==='pauseing'){s.state='running';s.startTime+=Date.now()-s._pauseTimesTamp;s.start()}};Animation.prototype.stopTimer=function(){var s=this;s.state='idle';cancelAnimationFrame(s._DataUpdateTimer)};Animation.prototype.easing=function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b};var _PageFx=new Animation();var _RestoreFx=new Animation();_RestoreFx.on('complete',function(){_Interaction.pageingSign=false;_RestoreFx.onUpdate=null});var _RestoreFx_X=new Animation();var _RestoreFx_Y=new Animation();var _ScrollFx_X=new SpeedDecay();var _ScrollFx_Y=new SpeedDecay();function Vimg(json){var s=this;s.image=null;s.getClientRects=null;s.src='';s.target=null;s.position={x:0,y:0};s.firstPosition={x:0,y:0};s.lastPosition={x:0,y:0};s.anchor={x:0,y:0};s.lastAnchor={x:0,y:0};s.width=0;s.height=0;s.naturalWidth=0;s.naturalHeight=0;s.rotate=0;s.scale=1;s.lastScale=1;s.maxScale=1;s.minScale=1;s.imageMargin=20;s.index=0;s.selected=false;s.isload=false;for(var name in json){if(s.hasOwnProperty(name)&&name in s){s[name]=json[name]}}Listeners.register(s)};Vimg.prototype.centered=function(){var s=this;s.left=ImageView.width*s.index+s.index*s.imageMargin;s.position.x=Math.round((ImageView.width-s.width)/2);s.position.y=Math.round((ImageView.height-s.height)/2);s.adjustPosition()};Vimg.prototype.adaptContainerSize=function(){var s=this;var width=Math.round(_Private.displayRectBox.height/s.naturalHeight*s.naturalWidth);var height=Math.round(_Private.displayRectBox.width/s.naturalWidth*s.naturalHeight);if(ImageView.pattern==='clipping'){if(width>=_Private.displayRectBox.width){s.width=width;s.height=_Private.displayRectBox.height}else if(height>=_Private.displayRectBox.height){s.width=_Private.displayRectBox.width;s.height=height}}else{if(width<=_Private.displayRectBox.width){s.width=width;s.height=_Private.displayRectBox.height}else if(height<=_Private.displayRectBox.height){s.width=_Private.displayRectBox.width;s.height=height}}s.maxScale=2};Vimg.prototype.useDataToImage=function(){var s=this;if(s.image){s.image.css({zIndex:2,top:s.top+'px',left:s.left+'px',width:s.width+'px',height:s.height+'px',transform:'translate3d('+s.position.x+'px, '+s.position.y+'px, 0) scale3d('+s.scale+','+s.scale+',1) rotateZ('+s.rotate+'deg)'})}};Vimg.prototype.adjustPosition=function(isinit){var s=this;var x=s.position.x;var y=s.position.y;var scale=s.scale;var rotate=s.rotate;var isAnimate=false;if(isinit){scale=1;rotate=0;x=(ImageView.width-s.width)/2;y=(ImageView.height-s.height)/2}else{if(s.scale>1){if(s.lastScale<1){scale=1;x=s.firstPosition.x;y=s.firstPosition.y}else if(s.scale>s.maxScale){scale=s.maxScale;x=_Private.displayRectBox.x+s.lastAnchor.x*(1-scale);y=_Private.displayRectBox.y+s.lastAnchor.y*(1-scale)}}else if(s.scale<1){if(s.lastScale>1){scale=1;x=s.firstPosition.x;y=s.firstPosition.y}else if(s.scale<s.minScale){scale=s.minScale}}var currentWidth=s.width*scale;var currentHeight=s.height*scale;if(currentWidth>_Private.displayRectBox.width){var maxX=-(currentWidth-_Private.displayRectBox.width-_Private.displayRectBox.x);if(x>_Private.displayRectBox.x){x=_Private.displayRectBox.x}else if(x<maxX){x=maxX}}else{x=(ImageView.width-currentWidth)/2}if(currentHeight>_Private.displayRectBox.height){var maxY=-(currentHeight-_Private.displayRectBox.height-_Private.displayRectBox.y);if(y>_Private.displayRectBox.y){y=_Private.displayRectBox.y}else if(y<maxY){y=maxY}}else{y=(ImageView.height-currentHeight)/2}}rotate=0;if(s.width*scale>=ImageView.width){s.lastPosition.x=0}else{s.lastPosition.x=x}if(s.height*scale>=ImageView.height){s.lastPosition.y=0}else{s.lastPosition.y=y}if(s.position.x!==x&&_ScrollFx_X.state!=='running'){_RestoreFx_X.init({x:s.position.x,},{x:x});_RestoreFx_X.duration=300;_RestoreFx_X.onUpdate=function(data){s.position.x=data.x};_RestoreFx_X.start()}if(s.position.y!==y&&_ScrollFx_Y.state!=='running'){_RestoreFx_Y.init({y:s.position.y,},{y:y});_RestoreFx_Y.duration=300;_RestoreFx_Y.onUpdate=function(data){s.position.y=data.y};_RestoreFx_Y.start()}_RestoreFx.init({scale:s.scale,rotate:s.rotate},{scale:scale,rotate:rotate});_RestoreFx.duration=300;_RestoreFx.onUpdate=function(data){s.scale=data.scale;s.rotate=data.rotate;s.useDataToImage()};_RestoreFx.start()};Vimg.prototype.scrollScreen=function(speed,touch){var s=this;var horDirection=touch.horDirection;var verDirection=touch.verDirection;var imageWidth=s.width*s.scale;var imageHeight=s.height*s.scale;var initViewBoxPositionX=_Private.viewBoxPositionX;var initPositionX=s.position.x;var initPositionY=s.position.y;var damping=.3;var friction=.7;var reaction=.05;var incrementX=1;var incrementY=1;var ViewBoxInitDataX=-(ImageView.width+ImageView.imageMargin)*(ImageView.page-1);if(Math.abs(speed.x)>_ScrollFx_X.minSpeed){_ScrollFx_X.init({x:s.position.x});_ScrollFx_X.initSpeed=speed.x;_ScrollFx_X.friction=friction;_ScrollFx_X.onUpdate=function(data){var posX=data.x;var pageX=ViewBoxInitDataX;var maxBeyond=imageWidth-_Private.displayRectBox.width;if(ImageView.pattern==='clipping'){var maxPosX=_Private.displayRectBox.x-maxBeyond;if(posX>_Private.displayRectBox.x){posX=_Private.displayRectBox.x}else if(posX<maxPosX){posX=maxPosX}}else{var leftBeyond=_Private.displayRectBox.x-posX;var rightBeyond=maxBeyond-leftBeyond;if(_ScrollFx_X.initSpeed<0){if(rightBeyond<=0){var rightinBeyond=posX+maxBeyond;if(initViewBoxPositionX<ViewBoxInitDataX){pageX=ViewBoxInitDataX+((initViewBoxPositionX-ViewBoxInitDataX)/damping+(posX-_ScrollFx_X.fromValue.x))*damping}else{pageX=ViewBoxInitDataX+rightinBeyond*damping}posX=-maxBeyond;_ScrollFx_X.friction*=incrementX;if(incrementX===1){incrementX=_ScrollFx_X.friction*reaction}}else if(initViewBoxPositionX>ViewBoxInitDataX){_ScrollFx_X.friction*=incrementX;pageX=initViewBoxPositionX+posX;posX=0;if(incrementX===1){incrementX=_ScrollFx_X.friction*reaction}}}else{if(leftBeyond<=0){var leftinBeyond=posX;_ScrollFx_X.friction*=incrementX;if(initViewBoxPositionX>ViewBoxInitDataX){pageX=ViewBoxInitDataX+((initViewBoxPositionX-ViewBoxInitDataX)/damping+posX)*damping}else{pageX=ViewBoxInitDataX+leftinBeyond*damping}posX=0;if(incrementX===1){incrementX=_ScrollFx_X.friction*reaction}}else if(initViewBoxPositionX<ViewBoxInitDataX){_ScrollFx_X.friction*=incrementX;pageX=initViewBoxPositionX-(-maxBeyond-posX);posX=-maxBeyond;if(incrementX===1){incrementX=_ScrollFx_X.friction*reaction}}}}s.position.x=posX;_Private.viewBoxPositionX=pageX;s.useDataToImage();_Private.setViewBoxPositionX()};_ScrollFx_X.onComplete=function(){ImageView.indexPage(ImageView.page)};_ScrollFx_X.start()}if(Math.abs(speed.y)>_ScrollFx_X.minSpeed){_ScrollFx_Y.init({y:s.position.y});_ScrollFx_Y.initSpeed=speed.y;_ScrollFx_Y.friction=friction;_ScrollFx_Y.onUpdate=function(data){var posY=data.y;var maxBeyond=imageHeight-_Private.displayRectBox.height;if(ImageView.pattern==='clipping'){var maxPosY=_Private.displayRectBox.y-maxBeyond;if(posY>_Private.displayRectBox.y){posY=_Private.displayRectBox.y}else if(posY<maxPosY){posY=maxPosY}}else{var topBeyond=_Private.displayRectBox.y-posY;var bottomBeyond=maxBeyond-topBeyond;if(verDirection==='top'){if(bottomBeyond<=0){var bottominBeyond=posY+maxBeyond-_Private.displayRectBox.y;if(initPositionY<-(maxBeyond-_Private.displayRectBox.y)){posY=-maxBeyond+((initPositionY+maxBeyond)/damping+(posY-initPositionY))*damping}else{posY=_Private.displayRectBox.y-maxBeyond+bottominBeyond*damping}_ScrollFx_Y.friction*=incrementY;if(incrementY===1){incrementY=_ScrollFx_Y.friction*reaction}}}else if(verDirection==='bottom'){if(topBeyond<=0){var topinBeyond=posY-_Private.displayRectBox.y;if(initPositionY>_Private.displayRectBox.y){posY=(initPositionY/damping+(posY-initPositionY))*damping}else{posY=_Private.displayRectBox.y+topinBeyond*damping}_ScrollFx_Y.friction*=incrementY;if(incrementY===1){incrementY=_ScrollFx_Y.friction*reaction}}}}s.position.y=posY;s.useDataToImage()};_ScrollFx_Y.onComplete=function(){ImageView.indexPage(ImageView.page)};_ScrollFx_Y.start()}if(speed.x===0&&speed.y===0){ImageView.indexPage(ImageView.page)}};function ImageView(){var s=this;s.width=window.innerWidth;s.height=window.innerHeight;s.page=1;s.vImageList=null;s.selector=null;s.pattern=null;s.imageMargin=null;s.clippingWidth=null;s.clippingHeight=null;s.clippingRadius=null;s.clippingBackground=null;s.clippingImportSuffix=null;s.isGestureRotate=null;s.isFindTargettoImageList=null;Listeners.register(s)};ImageView.prototype.show=function(json){var s=this;_Private.applyOptionParam(json);_Private.selectorDispose(s.selector);var isDisplay=false;if(s.vImageList.length){if(event){isDisplay=_Private.isEventTargettovImageList()}else{isDisplay=true}}if(isDisplay){_Private.loadImages(s.vImageList);document.body.appendChild(_Element.container);_Element.container.removeClass('iv_hide').setAttribute('data-pattern',s.pattern);var pageIndex=s.page-1;var vimg=s.vImageList[pageIndex];s.vImageList[pageIndex].selected=true;_Private.viewBoxPositionX=-(s.width+s.imageMargin)*pageIndex;_Private.updatePageData();_Private.setViewBoxPositionX();if(vimg.target.nodeType){_Private.imagesEaseinAnimate()}else{_Private.notAnimateShow()}if(s.pattern==='clipping'){_Private.clippingMaskAdaptContainerSize()}else{_Private.displayRectBox.x=0;_Private.displayRectBox.y=0;_Private.displayRectBox.width=ImageView.width;_Private.displayRectBox.height=ImageView.height}}};ImageView.prototype.close=function(){var s=this;var pageIndex=s.page-1;var vimg=s.vImageList[pageIndex];if(vimg.target.nodeType&&vimg.target.parentNode){_Private.imagesEaseoutAnimate()}else{_Private.notAnimateClose()}};ImageView.prototype.prevPage=function(){var s=this;var page=s.page;if(s.page>1){page--}s.indexPage(page)};ImageView.prototype.nextPage=function(){var s=this;var page=s.page;if(s.page<s.vImageList.length){page++}s.indexPage(page)};ImageView.prototype.indexPage=function(index){var s=this;var page=s.page;if(index>=1&&index<=s.vImageList.length){s.page=index}var end=-s.width*(s.page-1)-(s.imageMargin*(s.page-1));if(_Private.viewBoxPositionX-end){_PageFx.init({x:_Private.viewBoxPositionX},{x:end});_PageFx.duration=300;_PageFx.onUpdate=function(data){_Private.viewBoxPositionX=data.x;_Private.setViewBoxPositionX()};_PageFx.start()}if(page!==s.page){_Interaction.pageingSign=true}if(page===s.page){s.vImageList[page-1].adjustPosition()}else{s.vImageList[page-1].adjustPosition(true)}_Private.updatePageData()};ImageView.prototype.restore=function(){var s=this;s.page=1;s.vImageList=[];_Private.viewBoxPositionX=0;_Element.iv_viewBox.innerHTML='';_Element.iv_confbtn.innerText='完成';_Element.iv_confbtn.removeAttribute('disabled');_Private.checkboxsEvent()};ImageView=window.ImageView=new ImageView();var _Interaction={touchPath:[],downTouchList:[],viewBoxDataX:null,pageingSign:false,currentHandle:null,lastMoveDirection:null,touchstart:function(e){var touch={clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,identifier:e.changedTouches[0].identifier,timestamp:Date.now()};var index=_Interaction.downTouchList.indexOf2(touch.identifier,'identifier');if(index>-1){_Interaction.downTouchList[index].clientX=touch.clientX;_Interaction.downTouchList[index].clientY=touch.clientY;_Interaction.downTouchList[index].timestamp=touch.timestamp}else{_Interaction.downTouchList.push(touch)}_PageFx.stopTimer();if(!_Interaction.pageingSign){_RestoreFx.stopTimer();_ScrollFx_X.stopTimer();_ScrollFx_Y.stopTimer();_RestoreFx_X.stopTimer();_RestoreFx_Y.stopTimer()}ImageView.vImageList.forEach(function(item){item.image.style.zIndex='1'});if(!_Interaction.currentHandle){if(_Interaction.downTouchList.length===1){_Interaction.slidestart()}else{_Interaction.gesturestart()}}e.preventDefault()},touchmove:function(e){if(_Interaction.downTouchList.length){var touch=[];for(var i=0;i<e.touches.length;i++){touch.push({clientX:e.touches[i].clientX,clientY:e.touches[i].clientY,identifier:e.touches[i].identifier,timestamp:Date.now()})}_Interaction.downTouchList.forEach(function(item,i){var index=touch.indexOf2(item.identifier,'identifier');if(index>-1){if(touch[index].clientX<item.clientX){item.horDirection='left'}else{item.horDirection='right'}if(touch[index].clientY<item.clientY){item.verDirection='top'}else{item.verDirection='bottom'}item.isMove=true}else{_Interaction.downTouchList.splice(i,1);_Interaction.viewBoxDataX=_Private.viewBoxPositionX}});if(_Interaction.downTouchList.length<touch.length){touch.forEach(function(item){var index=_Interaction.downTouchList.indexOf2(item.identifier,'identifier');if(index===-1){_Interaction.downTouchList.push(item);_Interaction.gesturestart()}})}var handle='';if(_Interaction.currentHandle==='slide'||_Interaction.currentHandle==='slidescale'){handle='slide'}else if(_Interaction.currentHandle==='gesture'){handle='gesture'}else{if(_Interaction.downTouchList.length===1){_Interaction.currentHandle=handle='slide'}else{_Interaction.currentHandle=handle='gesture'}}if(handle==='slide'){_Interaction.slideing(touch[0])}else if(handle==='gesture'&&_Interaction.downTouchList.length>1){var touch1,touch2;var identifier1=_Interaction.downTouchList[0].identifier;var identifier2=_Interaction.downTouchList[1].identifier;_Interaction.downTouchList.forEach(function(item,i){item=touch[i];if(item.identifier===identifier1){touch1=item}else if(item.identifier===identifier2){touch2=item}});_Interaction.gesturechange(touch1,touch2)}e.preventDefault()}},touchend:function(e){if(_Interaction.downTouchList.length){var touch={clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,identifier:e.changedTouches[0].identifier,timestamp:Date.now()};var currentTouch;var index=_Interaction.downTouchList.indexOf2(touch.identifier,'identifier');if(index>-1){currentTouch=_Interaction.downTouchList.splice(index,1)[0]}if(_Interaction.downTouchList.length===0){_Interaction.slideend(currentTouch);_Interaction.currentHandle=null}else{_Interaction.gestureend(currentTouch)}if(currentTouch.clientX===touch.clientX&&currentTouch.clientY===touch.clientY){if(_Element.container.hasClass('iv_full')){_Element.container.removeClass('iv_full')}else{_Element.container.addClass('iv_full')}if(ImageView.pattern==='default'){ImageView.close()}}}},slidestart:function(){var vimg=ImageView.vImageList[ImageView.page-1];vimg.firstPosition.x=vimg.position.x;vimg.firstPosition.y=vimg.position.y;_Interaction.viewBoxDataX=_Private.viewBoxPositionX},slideing:function(touch){var s=ImageView;var moveX=touch.clientX-_Interaction.downTouchList[0].clientX;var moveY=touch.clientY-_Interaction.downTouchList[0].clientY;var damping=.3;var vimg=s.vImageList[s.page-1];var imageWidth=vimg.width*vimg.scale;var imageHeight=vimg.height*vimg.scale;var direc=_Interaction.downTouchList[0].horDirection;var vInitX=-(s.width+s.imageMargin)*(s.page-1);if(_Private.displayRectBox.width<imageWidth||_Private.displayRectBox.height<imageHeight){_Interaction.currentHandle='slidescale'}var posX=vimg.firstPosition.x+moveX;var posY=vimg.firstPosition.y+moveY;var pageX=vInitX;var maxLeftBeyondX=imageWidth-_Private.displayRectBox.width;var maxTopBeyondX=imageHeight-_Private.displayRectBox.height;var maxPosX=_Private.displayRectBox.x-maxLeftBeyondX;var maxPosY=_Private.displayRectBox.y-maxTopBeyondX;if(s.pattern==='clipping'){if(posX>_Private.displayRectBox.x){posX=_Private.displayRectBox.x}else if(posX<maxPosX){posX=maxPosX}if(posY>_Private.displayRectBox.y){posY=_Private.displayRectBox.y}else if(posY<maxPosY){posY=maxPosY}}else{if(imageWidth>_Private.displayRectBox.width){var leftBeyond=-posX;var rightBeyond=maxLeftBeyondX-leftBeyond;if(direc==='left'){if(rightBeyond>0){pageX=vInitX}else{if(pageX<=vInitX){posX=-maxLeftBeyondX;pageX=vInitX+rightBeyond;if(_Interaction.viewBoxDataX<vInitX){var beyond=_Interaction.viewBoxDataX-vInitX+moveX;pageX=vInitX+beyond}else{if(s.page==s.vImageList.length||Math.abs(vimg.firstPosition.x)!==imageWidth-s.width){if(_Interaction.viewBoxDataX<vInitX){var beyond=(_Interaction.viewBoxDataX-vInitX)/damping+moveX;pageX=vInitX+beyond*damping}else if(pageX<vInitX){pageX=vInitX+rightBeyond*damping}}else{_Interaction.currentHandle='slide'}}}}}else if(direc==='right'){if(leftBeyond>0){pageX=vInitX}else{if(pageX>=vInitX){posX=0;pageX=vInitX-leftBeyond;if(_Interaction.viewBoxDataX>vInitX){pageX=_Interaction.viewBoxDataX+moveX}else{if(vimg.firstPosition.x!==0||s.page==1){if(_Interaction.viewBoxDataX>vInitX){pageX=(_Interaction.viewBoxDataX/damping+moveX)*damping}else if(pageX>vInitX){pageX=vInitX+(pageX-vInitX)*damping}}else{_Interaction.currentHandle='slide'}}}}}}else{var lastX=-(s.width+s.imageMargin)*(s.vImageList.length-1);pageX=_Interaction.viewBoxDataX+moveX;if(pageX>0){if(_Interaction.viewBoxDataX>vInitX){pageX=(_Interaction.viewBoxDataX/damping+moveX)*damping}else{pageX=pageX*damping}}else if(pageX<lastX){if(_Interaction.viewBoxDataX<vInitX){var beyond=(_Interaction.viewBoxDataX-vInitX)/damping+moveX;pageX=vInitX+beyond*damping}else{var beyond=pageX-vInitX;pageX=vInitX+beyond*damping}}posX=vimg.firstPosition.x}if(imageWidth>_Private.displayRectBox.width||imageHeight>_Private.displayRectBox.height){if(posY>_Private.displayRectBox.y){if(vimg.firstPosition.y>_Private.displayRectBox.y){var beyond=(vimg.firstPosition.y-_Private.displayRectBox.y)/damping+moveY;posY=_Private.displayRectBox.y+beyond*damping}else{posY=_Private.displayRectBox.y+(posY-_Private.displayRectBox.y)*damping}}else if(posY<maxPosY){if(vimg.firstPosition.y<maxPosY){var beyond=(vimg.firstPosition.y-maxPosY)/damping+moveY;posY=maxPosY+beyond*damping}else{posY=maxPosY+(posY-maxPosY)*damping}}}else{posY=vimg.firstPosition.y}}_Interaction.touchPath.push(touch);vimg.position.x=posX;vimg.position.y=posY;_Private.viewBoxPositionX=pageX;vimg.useDataToImage();_Private.setViewBoxPositionX()},slideend:function(touch){var s=ImageView;touch.horDirection=touch.horDirection||_Interaction.lastMoveDirection;if(touch.isMove||_Private.viewBoxPositionX%s.width){var speed=_Interaction.getTouchMoveSpeed(10);if(_Interaction.currentHandle==='slidescale'){s.vImageList[s.page-1].scrollScreen(_Interaction.getTouchMoveSpeed(100),touch)}else{if(speed.x>=.3&&touch.horDirection==='right'){s.prevPage()}else if(speed.x<=-.3&&touch.horDirection==='left'){s.nextPage()}else{_Interaction.basedSlideXSetPage(touch.horDirection)}}}else{s.indexPage(s.page)}_Interaction.touchPath=[];_Interaction.currentHandle=null;_Interaction.lastMoveDirection=touch.horDirection},basedSlideXSetPage:function(horDirection){var s=ImageView;var viewWidth=s.width;var imageMargin=s.imageMargin*(s.page-1);var viewLeft=Math.min(_Private.viewBoxPositionX+imageMargin,0);var index=Math.abs(parseInt(viewLeft/viewWidth));if(horDirection==='right'){var moveX=viewWidth-Math.abs(viewLeft%viewWidth);if(Math.abs(moveX/viewWidth)>=.2){s.indexPage(index+1)}else{s.indexPage(s.page)}}else if(horDirection==='left'){var moveX=viewLeft%viewWidth;if(Math.abs(moveX/viewWidth)>=.2){s.indexPage(index+2)}else{s.indexPage(s.page)}}},getTouchMoveSpeed:function(time){var isfind;var SpeedList={x:0,y:0};var length=_Interaction.touchPath.length;if(length>1){if(Date.now()-_Interaction.touchPath[length-1].timestamp<100){isfind=false;var newTouch=_Interaction.touchPath[length-1];var timestamp=newTouch.timestamp-time;for(var i=length-1;i>=0;i--){var item=_Interaction.touchPath[i];if(item.timestamp===timestamp){isfind=true;SpeedList.x=newTouch.clientX-item.clientX;SpeedList.y=newTouch.clientY-item.clientY;break}else if(item.timestamp<timestamp){isfind=true;minTouch=item;maxTouch=_Interaction.touchPath[i+1];ratio=(timestamp-minTouch.timestamp)/(maxTouch.timestamp-minTouch.timestamp);SpeedList.x=newTouch.clientX-((maxTouch.clientX-minTouch.clientX)*ratio+minTouch.clientX);SpeedList.y=newTouch.clientY-((maxTouch.clientY-minTouch.clientY)*ratio+minTouch.clientY);break}}if(!isfind){ratio=(newTouch.timestamp-_Interaction.touchPath[0].timestamp)/time;SpeedList.x=(newTouch.clientX-_Interaction.touchPath[0].clientX)/ratio;SpeedList.y=(newTouch.clientY-_Interaction.touchPath[0].clientY)/ratio}}}return SpeedList},gesturestart:function(){var vimg=ImageView.vImageList[ImageView.page-1];var ratioX=(_Interaction.downTouchList[0].clientX-vimg.position.x)/(vimg.width*vimg.scale);var ratioY=(_Interaction.downTouchList[0].clientY-vimg.position.y)/(vimg.height*vimg.scale);vimg.lastScale=vimg.scale;vimg.anchor.x=vimg.width*ratioX;vimg.anchor.y=vimg.height*ratioY;vimg.firstPosition.x=vimg.position.x-(1-vimg.scale)*vimg.anchor.x;vimg.firstPosition.y=vimg.position.y-(1-vimg.scale)*vimg.anchor.y},gesturechange:function(touch1,touch2){var scale=_Interaction.getDistance(touch1,touch2)/_Interaction.getDistance(_Interaction.downTouchList[0],_Interaction.downTouchList[1]);var rotate=0;var vimg=ImageView.vImageList[ImageView.page-1];var a=1,b=0,c=0,d=1,tx,ty;if(ImageView.isGestureRotate&&ImageView.pattern!=='clipping'){rotate=_Interaction.getAngle(touch1,touch2)-_Interaction.getAngle(_Interaction.downTouchList[0],_Interaction.downTouchList[1]);if(rotate>180){rotate=-(360-rotate)}var pi=Math.PI/180;var radian=pi*rotate;var cos=Math.cos(radian);var sin=Math.sin(radian);a=cos;b=sin;c=-sin;d=cos}scale*=vimg.lastScale;a*=scale;b*=scale;c*=scale;d*=scale;var tx=0;var ty=0;tx=touch1.clientX-(vimg.anchor.x*a+vimg.anchor.y*c);ty=touch1.clientY-(vimg.anchor.y*d+vimg.anchor.x*b);var centerX=(touch1.clientX+touch2.clientX)/2;var centerY=(touch1.clientY+touch2.clientY)/2;var ratioX=(centerX-vimg.position.x)/(vimg.width*vimg.scale);var ratioY=(centerY-vimg.position.y)/(vimg.height*vimg.scale);vimg.lastAnchor.x=vimg.width*ratioX;vimg.lastAnchor.y=vimg.height*ratioY;vimg.scale=scale;vimg.rotate=rotate;vimg.position.x=tx;vimg.position.y=ty;vimg.useDataToImage()},gestureend:function(touch){_Interaction.currentHandle=null;_Interaction.downTouchList=[];_Interaction.viewBoxDataX=_Private.viewBoxPositionX;ImageView.indexPage(ImageView.page)},getDistance:function(p1,p2){var x=p2.clientX-p1.clientX,y=p2.clientY-p1.clientY;return Math.sqrt((x*x)+(y*y))},getAngle:function(p1,p2){var x=p1.clientX-p2.clientX,y=p1.clientY-p2.clientY;return Math.atan2(y,x)*180/Math.PI}};var _Element={};var _Private={viewBoxPositionX:0,displayRectBox:{},init:function(){var s=ImageView;document.head.innerHTML="<style>html{font-size:100px;font-size:calc(100vw/3.2)}body{font-size:.14rem}.imageViewer{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;color:#3f3f3f;font-size:.14rem;-webkit-user-select:none;user-select:none}.imageViewer .iv_hide{display:none!important}.imageViewer .iv_lArrow{position:relative;display:inline-block;width:.16rem;height:.16rem;vertical-align:sub}.imageViewer .iv_lArrow:after{position:absolute;top:50%;left:70%;box-sizing:border-box;width:70%;height:70%;border-color:#989898;border-style:solid;border-width:2px;content:'';-webkit-transform:translate3d(-50%,-50%,0) rotateZ(-45deg);transform:translate3d(-50%,-50%,0) rotateZ(-45deg);border-right-color:transparent!important;border-bottom-color:transparent!important}.imageViewer .iv_checkboxs{position:relative;display:inline-block;width:.16rem;height:.16rem;border:solid 1px #bbb;border-radius:.02rem;vertical-align:top}.imageViewer .iv_checkboxs::after{position:absolute;top:40%;left:50%;display:none;box-sizing:border-box;width:70%;height:40%;border-color:#fff;border-style:solid;border-width:2px;content:'';-webkit-transform:translate3d(-50%,-50%,0) rotateZ(-45deg);transform:translate3d(-50%,-50%,0) rotateZ(-45deg);border-top-color:transparent!important;border-right-color:transparent!important}.imageViewer .iv_checkboxs[data-checked=true]{border-color:#1CCDA6;background:#1CCDA6}.imageViewer .iv_checkboxs[data-checked=true]:after{display:block}.imageViewer .iv_checkalone{float:right}.imageViewer .iv_checkall{float:left}.imageViewer .iv_block{position:absolute;top:0;right:0;left:0;z-index:50}.imageViewer .iv_head{position:absolute;top:0;right:0;left:0;z-index:50;height:.4rem;background:#fff;-webkit-transform:translateY(-100%);transform:translateY(-100%)}.imageViewer .iv_head:after{position:absolute;right:0;bottom:0;left:0;height:1px;background:#b2b2b2;content:'';-webkit-transform:scaleY(.5);transform:scaleY(.5);-webkit-transform-origin:0 100%;transform-origin:0 100%}.imageViewer .iv_head .iv_closebtn{position:relative;z-index:2;float:left;padding:.09rem}.imageViewer .iv_head .iv_closebtn:after{position:absolute;top:50%;right:0;width:0;height:50%;border-right:solid 1px #ddd;content:'';-webkit-transform:translateY(-50%);transform:translateY(-50%)}.imageViewer .iv_head .iv_lArrow{width:.22rem;height:.22rem}.imageViewer .iv_head .iv_lArrow:after{border-color:#666}.imageViewer .iv_head .iv_title{position:absolute;top:50%;padding-left:.5rem;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.imageViewer .iv_head .iv_confbtn,.imageViewer .iv_head .iv_delbtn{float:right;margin:.06rem;padding:.06rem .1rem;border-radius:.02rem;background:#f74c48;color:#fff;font-size:.12rem;line-height:.16rem}.imageViewer .iv_head .iv_delbtn:active{background:#e43430}.imageViewer .iv_head .iv_confbtn{padding:.06rem .15rem;background:#48ce55}.imageViewer .iv_head .iv_confbtn:active{background:#2fbf3d}.imageViewer .iv_head .iv_confbtn[disabled],.imageViewer .iv_head .iv_delbtn[disabled]{background:#ccc}.imageViewer .iv_head .iv_confbtn[disabled]:active,.imageViewer .iv_head .iv_delbtn[disabled]:active{background:#ccc}.imageViewer .iv_view{position:absolute;top:0;right:0;bottom:0;left:0;z-index:4;overflow:hidden;background:#2b2b2b;color:#fff;opacity:0}.imageViewer .iv_masks{position:absolute;pointer-events:none;width:100%;height:100%;top:50%;left:50%;z-index:20;box-sizing:border-box;border:solid 1px #fff;box-shadow:0 0 0 3rem rgba(0,0,0,.6);-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0)}.imageViewer .iv_viewBox{position:absolute;width:100%;height:100%}.imageViewer .iv_view img{position:absolute;top:0;left:0;-webkit-transform-origin:0 0;transform-origin:0 0}.imageViewer .iv_bottom{position:absolute;right:0;bottom:0;left:0;z-index:50;height:.4rem;background:#fff;-webkit-transform:translateY(100%);transform:translateY(100%)}.imageViewer .iv_bottom:before{position:absolute;top:0;right:0;left:0;height:1px;background:#b2b2b2;content:'';-webkit-transform:scaleY(.5);transform:scaleY(.5);-webkit-transform-origin:0 0;transform-origin:0 0}.imageViewer .iv_check{padding:.11rem .1rem;line-height:.18rem}.imageViewer .iv_check .iv_checkboxs{margin-right:.05rem}.imageViewer .iv_check .iv_checkboxs{border-color:#bbb}.imageViewer .iv_check .iv_checkboxs[data-checked=true]{border-color:#48ce55;background:#48ce55}.imageViewer .iv_animate{position:absolute;left:0;top:0;z-index:10;transform-origin:0 0;-webkit-transform-origin:0 0}.imageViewer .iv_animate .iv_img{position:absolute;left:0;top:0;right:0;bottom:0;background-repeat:no-repeat;background-size:100% 100%}.imageViewer.iv_fade_in .iv_view{opacity:1;-webkit-transition:opacity .2s ease-out;transition:opacity .2s ease-out}.imageViewer.iv_fade_in .iv_bottom,.imageViewer.iv_fade_in .iv_head{-webkit-transition:-webkit-transform .2s ease-out;transition:transform .2s ease-out;-webkit-transform:translateY(0);transform:translateY(0)}.imageViewer.iv_fade_out .iv_view{opacity:0;-webkit-transition:opacity .2s ease-out;transition:opacity .2s ease-out}.imageViewer.iv_fade_out .iv_head,.imageViewer.iv_full .iv_head{-webkit-transition:-webkit-transform .2s ease-out;transition:transform .2s ease-out;-webkit-transform:translateY(-100%);transform:translateY(-100%)}.imageViewer.iv_fade_out .iv_bottom,.imageViewer.iv_full .iv_bottom{-webkit-transition:-webkit-transform .2s ease-out;transition:transform .2s ease-out;-webkit-transform:translateY(100%);transform:translateY(100%)}.imageViewer.iv_fade_out .iv_view{pointer-events:none}.imageViewer[data-pattern=default] .iv_bottom,.imageViewer[data-pattern=default] .iv_head,.imageViewer[data-pattern=default] .iv_masks{display:none}.imageViewer[data-pattern=edit] .iv_head .iv_confbtn,.imageViewer[data-pattern=edit] .iv_masks{display:none}.imageViewer[data-pattern=clipping] .iv_bottom,.imageViewer[data-pattern=clipping] .iv_head .iv_delbtn,.imageViewer[data-pattern=clipping] .iv_head .iv_title{display:none}.imageViewer[data-state=in] .iv_animate{-webkit-transition:all .2s cubic-bezier(0,0,.1,1);transition:all .2s cubic-bezier(0,0,.1,1)}.imageViewer[data-state=in] .iv_animate .iv_img{-webkit-transition:all .2s cubic-bezier(0,0,.1,1);transition:all .2s cubic-bezier(0,0,.1,1)}.imageViewer[data-state=out] .iv_animate{-webkit-transition:all .2s cubic-bezier(0,0,0,1);transition:all .2s cubic-bezier(0,0,0,1)}.imageViewer[data-state=out] .iv_animate .iv_img{-webkit-transition:all .2s cubic-bezier(0,0,0,1);transition:all .2s cubic-bezier(0,0,0,1)}.imageViewer[data-state=in] .iv_masks{transition:all .2s cubic-bezier(0,0,0,1);-webkit-transition:all .2s cubic-bezier(0,0,0,1)}.imageViewer[data-state=out] .iv_masks{transition:all .2s cubic-bezier(0,0,0,1);-webkit-transition:all .2s cubic-bezier(0,0,0,1)}.imageViewer[data-state=in] .iv_viewBox,.imageViewer[data-state=out] .iv_viewBox{display:none}</style>"+document.head.innerHTML;_Element.container=document.createElement('div');_Element.container.addClass('imageViewer iv_hide');_Element.container.innerHTML='<div class="iv_masks"></div><div class="iv_block"></div><div class="iv_animate"><div class="iv_img"></div></div><div class="iv_head"><div class="iv_closebtn"><div class="iv_lArrow"><i></i></div></div><div class="iv_title">0/0</div><div class="iv_delbtn">删除</div><div class="iv_confbtn">完成</div></div><div class="iv_view"><div class="iv_viewBox"></div></div><div class="iv_bottom"><div class="iv_check iv_checkall"><div class="iv_checkboxs"></div><span class="text">全选</span></div><div class="iv_check iv_checkalone"><div class="iv_checkboxs"></div><span class="text">选择</span></div></div>';_Element.iv_masks=_Element.container.querySelector('.iv_masks');_Element.iv_view=_Element.container.querySelector('.iv_view');_Element.iv_viewBox=_Element.container.querySelector('.iv_viewBox');_Element.iv_block=_Element.container.querySelector('.iv_block');_Element.iv_animate=_Element.container.querySelector('.iv_animate');_Element.iv_img=_Element.iv_animate.querySelector('.iv_img');_Element.iv_head=_Element.container.querySelector('.iv_head');_Element.iv_closebtn=_Element.iv_head.querySelector('.iv_closebtn');_Element.iv_title=_Element.iv_head.querySelector('.iv_title');_Element.iv_delbtn=_Element.iv_head.querySelector('.iv_delbtn');_Element.iv_confbtn=_Element.iv_head.querySelector('.iv_confbtn');_Element.iv_bottom=_Element.container.querySelector('.iv_bottom');_Element.iv_checkalone=_Element.iv_bottom.querySelector('.iv_checkalone');_Element.iv_checkall=_Element.iv_bottom.querySelector('.iv_checkall');_Element.iv_checkboxs=_Element.iv_checkalone.querySelector('.iv_checkboxs');_Element.iv_checkboxsAll=_Element.iv_checkall.querySelector('.iv_checkboxs');_Element.iv_checkalone.addEventListener('click',function(){_Private.checkboxsEvent();if(_Element.iv_checkboxs.getAttribute('data-checked')==='true'){s.vImageList[s.page-1].selected=true}else{s.vImageList[s.page-1].selected=false}_Private.updatePageData()});_Element.iv_checkall.addEventListener('click',function(){_Private.checkboxsEvent();if(_Element.iv_checkboxsAll.getAttribute('data-checked')==='true'){s.vImageList.forEach(function(item){item.selected=true})}else{s.vImageList.forEach(function(item){item.selected=false})}_Private.updatePageData()});_Element.iv_delbtn.addEventListener('click',function(){var s=ImageView;if(_Element.iv_delbtn.getAttribute('disabled')===null){var list=_Private.getSelectedImage();list.forEach(function(item,i){list[i]={index:item.index,target:item.target}});if(list.length){s.dispatchEvent('delete',list)}s.close()}});_Element.iv_closebtn.addEventListener('click',function(){ImageView.close()});_Element.iv_confbtn.addEventListener('click',function(){if(_Element.iv_confbtn.getAttribute('disabled')===null){_Element.iv_confbtn.innerText='加载中...';_Element.iv_confbtn.setAttribute('disabled','');setTimeout(function(){var image=_Private.importClippingtoImage();s.close();s.dispatchEvent('clipping',image)})}});_Element.iv_view.addEventListener('touchstart',_Interaction.touchstart,{passive:false});_Element.iv_view.addEventListener('touchmove',_Interaction.touchmove,{passive:false});_Element.iv_view.addEventListener('touchend',_Interaction.touchend,{passive:false});s.on('close',function(){s.restore()})},notAnimateShow:function(){var s=ImageView;_Element.iv_block.removeClass('iv_hide');setTimeout(function(){_Element.container.setAttribute('data-state','default');_Element.container.removeClass('iv_fade_out').addClass('iv_fade_in');setTimeout(function(){_Element.iv_block.addClass('iv_hide');s.dispatchEvent('show')},200)},40)},notAnimateClose:function(){var s=ImageView;_Element.iv_block.removeClass('iv_hide');setTimeout(function(){_Element.container.setAttribute('data-state','default');_Element.container.removeClass('iv_fade_in').addClass('iv_fade_out');setTimeout(function(){_Element.iv_block.addClass('iv_hide');_Element.container.remove();s.dispatchEvent('close')},200)},40)},imagesEaseinAnimate:function(){var s=ImageView;var pageIndex=s.page-1;var vimg=s.vImageList[pageIndex];vimg.onLoad=function(){if(vimg.target.nodeName.toLowerCase()==='img'){var rectbox=_Private.getTargetImagesData()}else{var rectbox=_Private.getTargetBackData()}_Element.iv_animate.css({width:rectbox.displayWidth+'px',height:rectbox.displayHeight+'px',transform:'translate3d('+rectbox.displayLeft+'px, '+rectbox.displayTop+'px, 0) scale3d(1,1,1)'});_Element.iv_img.css({backgroundImage:'url('+vimg.src+')',clipPath:'polygon('+rectbox.retpos[0][0]+'px '+rectbox.retpos[0][1]+'px, '+rectbox.retpos[1][0]+'px '+rectbox.retpos[1][1]+'px, '+rectbox.retpos[2][0]+'px '+rectbox.retpos[2][1]+'px, '+rectbox.retpos[3][0]+'px '+rectbox.retpos[3][1]+'px)'});_Element.iv_block.removeClass('iv_hide');_Element.iv_animate.removeClass('iv_hide');setTimeout(function(){_Element.container.setAttribute('data-state','in');_Element.iv_animate.css({transform:'translate3d('+vimg.position.x+'px, '+vimg.position.y+'px, 0) scale3d('+rectbox.scale+','+rectbox.scale+',1)'});_Element.iv_img.css({clipPath:'polygon(0 0, 100% 0, 100% 100%, 0 100%)'});if(s.pattern==='clipping'){_Element.iv_masks.css({width:_Private.displayRectBox.width+'px',height:_Private.displayRectBox.height+'px',borderRadius:_Private.displayRectBox.clippingRadius+'px'})}_Element.container.removeClass('iv_fade_out').addClass('iv_fade_in');setTimeout(function(){_Element.iv_block.addClass('iv_hide');_Element.iv_animate.addClass('iv_hide').setAttribute('data-state','');_Element.container.setAttribute('data-state','default')},200)},40)};if(vimg.isload){vimg.onLoad.call(vimg)}},imagesEaseoutAnimate:function(){var s=ImageView;var pageIndex=s.page-1;var vimg=s.vImageList[pageIndex];if(vimg.target.nodeName.toLowerCase()==='img'){var rectbox=_Private.getTargetImagesData()}else{var rectbox=_Private.getTargetBackData()}_Element.iv_animate.css({width:vimg.width+'px',height:vimg.height+'px',transform:'translate3d('+vimg.position.x+'px, '+vimg.position.y+'px, 0) scale3d(1,1,1)'});_Element.iv_img.css({backgroundImage:'url('+vimg.src+')',clipPath:'polygon(0 0, 100% 0, 100% 100%, 0 100%)'});_Element.iv_block.removeClass('iv_hide');_Element.iv_animate.removeClass('iv_hide');setTimeout(function(){var scale=rectbox.displayWidth/vimg.width;_Element.container.setAttribute('data-state','out');_Element.iv_animate.css({transform:'translate3d('+rectbox.displayLeft+'px, '+rectbox.displayTop+'px, 0) scale3d('+scale+','+scale+',1)'});_Element.iv_img.css({clipPath:'polygon('+rectbox.retpos[0][0]/scale+'px '+rectbox.retpos[0][1]/scale+'px, '+rectbox.retpos[1][0]/scale+'px '+rectbox.retpos[1][1]/scale+'px, '+rectbox.retpos[2][0]/scale+'px '+rectbox.retpos[2][1]/scale+'px, '+rectbox.retpos[3][0]/scale+'px '+rectbox.retpos[3][1]/scale+'px)'});if(s.pattern==='clipping'){_Element.iv_masks.css({width:'100%',height:'100%',borderRadius:'0'})}_Element.container.removeClass('iv_fade_in').addClass('iv_fade_out');setTimeout(function(){_Element.iv_block.addClass('iv_hide');_Element.iv_animate.addClass('iv_hide').setAttribute('data-state','');_Element.container.setAttribute('data-state','default');_Element.container.removeClass('iv_fade_out').remove()},200)},40)},getTargetBackData:function(){var s=ImageView;var pageIndex=s.page-1;var vimg=s.vImageList[pageIndex];var targetElement=s.vImageList[pageIndex].target;var targetRectbox=targetElement.getBoundingClientRect();var displayRectbox={};var parentNode=targetElement.parentNode;var borderTop=targetElement.getComputedStyle('borderTopWidth');var borderLeft=targetElement.getComputedStyle('borderLeftWidth');var borderRight=targetElement.getComputedStyle('borderRightWidth');var borderBottom=targetElement.getComputedStyle('borderBottomWidth');displayRectbox.visibleTop=targetRectbox.top+borderTop;displayRectbox.visibleLeft=targetRectbox.left+borderLeft;displayRectbox.visibleWidth=targetRectbox.width-borderRight-borderLeft;displayRectbox.visibleHeight=targetRectbox.height-borderBottom-borderTop;displayRectbox.displayTop=targetRectbox.top;displayRectbox.displayLeft=targetRectbox.left;displayRectbox.displayWidth=targetRectbox.width;displayRectbox.displayHeight=targetRectbox.height;while(parentNode&&parentNode!==document){var isContainer=false;if(parentNode.getComputedStyle('width')<targetElement.getComputedStyle('width')){switch(parentNode.getComputedStyle('overflowX')){case'auto':case'scroll':case'hidden':isContainer=true;break}}else if(parentNode.getComputedStyle('height')<targetElement.getComputedStyle('height')){switch(parentNode.getComputedStyle('overflowY')){case'auto':case'scroll':case'hidden':isContainer=true;break}}if(isContainer){var rectbox=parentNode.getBoundingClientRect();if(rectbox.top>targetRectbox.top){displayRectbox.visibleTop=rectbox.top+parentNode.getComputedStyle('borderTopWidth');displayRectbox.visibleHeight-=(displayRectbox.visibleTop-targetRectbox.top)}if(rectbox.bottom<targetRectbox.bottom){displayRectbox.visibleHeight-=(targetRectbox.top+targetRectbox.height)-(rectbox.top+rectbox.height)}if(rectbox.left>targetRectbox.left){displayRectbox.visibleLeft=rectbox.left+parentNode.getComputedStyle('borderLeftWidth');displayRectbox.visibleWidth-=(displayRectbox.visibleLeft-targetRectbox.left)}if(rectbox.right<targetRectbox.right){displayRectbox.visibleWidth-=(targetRectbox.left+targetRectbox.width)-(rectbox.left+rectbox.width)}displayRectbox.visibleWidth-=parentNode.getComputedStyle('borderRightWidth');displayRectbox.visibleHeight-=parentNode.getComputedStyle('borderBottomWidth')}parentNode=parentNode.parentNode}var res;var backgroundSize=getComputedStyle(targetElement)['backgroundSize'];if(res=/^([0-9.]+)([a-z%]+)$/.exec(backgroundSize)){switch(res[2]){case'px':displayRectbox.displayWidth=res[1]*displayRectbox.displayWidth;break;case'%':displayRectbox.displayWidth=res[1]/100*displayRectbox.displayWidth;break}displayRectbox.displayHeight=displayRectbox.displayWidth/vimg.width*vimg.height}else if(res=/^auto ([0-9.]+)([a-z%]+)$/i.exec(backgroundSize)){switch(res[2]){case'px':displayRectbox.displayHeight=res[1]*displayRectbox.displayHeight;break;case'%':displayRectbox.displayHeight=res[1]/100*displayRectbox.displayHeight;break}displayRectbox.displayWidth=displayRectbox.displayHeight/vimg.height*vimg.width}else if(res=/^([0-9.]+)([a-z%]+) ([0-9.]+)([a-z%]+)$/.exec(backgroundSize)){switch(res[2]){case'px':displayRectbox.displayWidth=Number(res[1]);break;case'%':displayRectbox.displayWidth=res[1]/100*displayRectbox.displayWidth;break}switch(res[4]){case'px':displayRectbox.displayHeight=Number(res[3]);break;case'%':displayRectbox.displayHeight=res[3]/100*displayRectbox.displayHeight;break}}else if(backgroundSize==='cover'){displayRectbox.displayWidth=displayRectbox.visibleHeight/vimg.height*vimg.width;displayRectbox.displayHeight=displayRectbox.visibleWidth/vimg.width*vimg.height;if(displayRectbox.displayWidth>=displayRectbox.visibleWidth){displayRectbox.displayHeight=displayRectbox.displayWidth/vimg.width*vimg.height}else{displayRectbox.displayWidth=displayRectbox.displayHeight/vimg.height*vimg.width}}else if(backgroundSize==='contain'){displayRectbox.displayWidth=displayRectbox.visibleHeight/vimg.height*vimg.width;displayRectbox.displayHeight=displayRectbox.visibleWidth/vimg.width*vimg.height;if(displayRectbox.displayWidth<=displayRectbox.visibleWidth){displayRectbox.displayHeight=displayRectbox.displayWidth/vimg.width*vimg.height}else{displayRectbox.displayWidth=displayRectbox.displayHeight/vimg.height*vimg.width}}displayRectbox.displayWidth=Math.round(displayRectbox.displayWidth);displayRectbox.displayHeight=Math.round(displayRectbox.displayHeight);var ratioX,ratioY;var backgroundPositionX=getComputedStyle(targetElement)['backgroundPositionX']||0;var backgroundPositionY=getComputedStyle(targetElement)['backgroundPositionY']||0;if(res=/^([0-9.]+)([a-z%]+)$/.exec(backgroundPositionX)){switch(res[2]){case'px':displayRectbox.displayLeft=Number(res[1])+displayRectbox.visibleLeft;break;case'%':ratioX=res[1]/100;break}}if(res=/^([0-9.]+)([a-z%]+)$/.exec(backgroundPositionY)){switch(res[2]){case'px':displayRectbox.displayTop=Number(res[1])+displayRectbox.visibleTop;break;case'%':ratioY=res[1]/100;break}}if(ratioX!==undefined){displayRectbox.displayLeft=(displayRectbox.visibleWidth-displayRectbox.displayWidth)*ratioX+displayRectbox.visibleLeft}if(ratioY!==undefined){displayRectbox.displayTop=(displayRectbox.visibleHeight-displayRectbox.displayHeight)*ratioY+displayRectbox.visibleTop}displayRectbox.scale=vimg.width/displayRectbox.displayWidth;displayRectbox.retpos=[];displayRectbox.retpos[0]=[displayRectbox.visibleLeft-displayRectbox.displayLeft,displayRectbox.visibleTop-displayRectbox.displayTop];displayRectbox.retpos[1]=[displayRectbox.retpos[0][0]+displayRectbox.visibleWidth,displayRectbox.retpos[0][1],];displayRectbox.retpos[2]=[displayRectbox.retpos[1][0],displayRectbox.retpos[1][1]+displayRectbox.visibleHeight,];displayRectbox.retpos[3]=[displayRectbox.retpos[0][0],displayRectbox.retpos[0][1]+displayRectbox.visibleHeight,];return displayRectbox},getTargetImagesData:function(){var s=ImageView;var pageIndex=s.page-1;var vimg=s.vImageList[pageIndex];var targetElement=s.vImageList[pageIndex].target;var targetRectbox=targetElement.getBoundingClientRect();var displayRectbox={};var parentNode=targetElement.parentNode;displayRectbox.visibleTop=targetRectbox.top;displayRectbox.visibleLeft=targetRectbox.left;displayRectbox.visibleWidth=targetRectbox.width;displayRectbox.visibleHeight=targetRectbox.height;displayRectbox.displayTop=targetRectbox.top;displayRectbox.displayLeft=targetRectbox.left;displayRectbox.displayWidth=targetRectbox.width;displayRectbox.displayHeight=targetRectbox.height;while(parentNode&&parentNode!==document){var isContainer=false;if(parentNode.getComputedStyle('width')<targetElement.getComputedStyle('width')){switch(parentNode.getComputedStyle('overflowX')){case'auto':case'scroll':case'hidden':isContainer=true;break}}else if(parentNode.getComputedStyle('height')<targetElement.getComputedStyle('height')){switch(parentNode.getComputedStyle('overflowY')){case'auto':case'scroll':case'hidden':isContainer=true;break}}if(isContainer){var rectbox=parentNode.getBoundingClientRect();if(rectbox.top>targetRectbox.top){displayRectbox.visibleTop=rectbox.top+parentNode.getComputedStyle('borderTopWidth');displayRectbox.visibleHeight-=(displayRectbox.visibleTop-targetRectbox.top)}if(rectbox.bottom<targetRectbox.bottom){displayRectbox.visibleHeight-=(targetRectbox.top+targetRectbox.height)-(rectbox.top+rectbox.height)}if(rectbox.left>targetRectbox.left){displayRectbox.visibleLeft=rectbox.left+parentNode.getComputedStyle('borderLeftWidth');displayRectbox.visibleWidth-=(displayRectbox.visibleLeft-targetRectbox.left)}if(rectbox.right<targetRectbox.right){displayRectbox.visibleWidth-=(targetRectbox.left+targetRectbox.width)-(rectbox.left+rectbox.width)}displayRectbox.visibleWidth-=parentNode.getComputedStyle('borderRightWidth');displayRectbox.visibleHeight-=parentNode.getComputedStyle('borderBottomWidth')}parentNode=parentNode.parentNode}displayRectbox.scale=vimg.width/displayRectbox.displayWidth;displayRectbox.retpos=[];displayRectbox.retpos[0]=[displayRectbox.visibleLeft-displayRectbox.displayLeft,displayRectbox.visibleTop-displayRectbox.displayTop];displayRectbox.retpos[1]=[displayRectbox.retpos[0][0]+displayRectbox.visibleWidth,displayRectbox.retpos[0][1],];displayRectbox.retpos[2]=[displayRectbox.retpos[1][0],displayRectbox.retpos[1][1]+displayRectbox.visibleHeight,];displayRectbox.retpos[3]=[displayRectbox.retpos[0][0],displayRectbox.retpos[0][1]+displayRectbox.visibleHeight,];return displayRectbox},loadImages:function(list){var index=0;list.forEach(function(item,i){var w,h,left,top,width,height;var image=document.createElement('img');image.src=item.src;image.onload=function(){item.isload=true;item.naturalWidth=image.naturalWidth;item.naturalHeight=image.naturalHeight;item.adaptContainerSize();item.centered();item.useDataToImage();item.dispatchEvent('load')};item.image=image;item.index=index++;item.imageMargin=ImageView.imageMargin;_Element.iv_viewBox.appendChild(image)})},updatePageData:function(){var s=ImageView;var list=_Private.getSelectedImage();if(list.length){_Element.iv_delbtn.removeAttribute('disabled')}else{_Element.iv_delbtn.setAttribute('disabled','')}if(list.length===s.vImageList.length){_Element.iv_checkboxsAll.setAttribute('data-checked',true)}else{_Element.iv_checkboxsAll.setAttribute('data-checked',false)}if(s.vImageList[s.page-1].selected===true){_Element.iv_checkboxs.setAttribute('data-checked',true)}else{_Element.iv_checkboxs.setAttribute('data-checked',false)}if(s.pattern!=='clipping'){_Element.iv_title.innerText=s.page+'/'+s.vImageList.length}_Element.iv_delbtn.innerText='删除'+list.length+'/'+s.vImageList.length},applyOptionParam:function(json){var s=ImageView;var defaultOption={pattern:'default',selector:'',imageMargin:10,clippingWidth:s.width,clippingHeight:s.height,clippingRadius:0,clippingBackground:'',clippingImportSuffix:'png',isGestureRotate:true,isFindTargettoImageList:true};for(var name in json){if(defaultOption.hasOwnProperty(name)&&name in defaultOption){defaultOption[name]=json[name]}}for(var name in defaultOption){if(s.hasOwnProperty(name)&&name in s){s[name]=defaultOption[name]}}},selectorDispose:function(selector){var list=[];var target=event&&event.target;var currentTarget=event&&event.currentTarget;if(isType(selector,'array')){selector.forEach(function(item){if(typeof item==='string'){list.push(new Vimg({src:item,target:item}))}else if(typeof item==='object'){if(item.src){list.push(new Vimg({src:item.src,target:item}))}}})}else if(isType(selector,'string')){if(currentTarget){currentTarget=currentTarget.querySelectorAll(selector);if(!currentTarget.length){currentTarget=document.querySelectorAll(selector)}}else{currentTarget=document.querySelectorAll(selector)}var item;for(var i=0;i<currentTarget.length;i++){item=currentTarget[i];if(item.nodeName.toLowerCase()==='img'){list.push(new Vimg({src:item.src,target:item}))}else{var backImage=window.getComputedStyle(item).backgroundImage;if(/^url/.test(backImage)){list.push(new Vimg({src:backImage.replace(/^url\(["']|url\(/ig,'').replace(/["\']\)|\)$/g,''),target:item}))}}}}if(ImageView.pattern==='clipping'&&list.length>0){if(target){for(var i=0;i<list.length;i++){if(list[i].target===target){list=[list[i]]}}}else{list=[list[0]]}}ImageView.vImageList=list},getSelectedImage:function(){var selectedList=[];ImageView.vImageList.forEach(function(item){if(item.selected){selectedList.push(item)}});return selectedList},setViewBoxPositionX:function(){_Element.iv_viewBox.style.webkitTransform=_Element.iv_viewBox.style.transform='translateX('+_Private.viewBoxPositionX+'px)'},importClippingtoImage:function(){var s=ImageView;var vimg=s.vImageList[0];var imageWidth=vimg.width*vimg.scale;var magnify=Math.max(vimg.naturalWidth/imageWidth,1);var drawCanvas=document.createElement('canvas');var drawContext=drawCanvas.getContext('2d');drawCanvas.width=s.width*magnify;drawCanvas.height=s.height*magnify;var outputCanvas=document.createElement('canvas');var outputContext=outputCanvas.getContext('2d');outputCanvas.width=s.clippingWidth;outputCanvas.height=s.clippingHeight;var radius=_Private.displayRectBox.width/s.clippingWidth*s.clippingRadius;radius=Math.min(Math.min(_Private.displayRectBox.width,_Private.displayRectBox.height)/2,radius)*magnify;if(s.clippingBackground){drawContext.fillStyle=s.clippingBackground;drawContext.fillRect(0,0,drawCanvas.width,drawCanvas.height)}drawContext.save();drawContext.setTransform(1,0,0,1,_Private.displayRectBox.x*magnify,_Private.displayRectBox.y*magnify);drawContext.radiusRect(_Private.displayRectBox.width*magnify,_Private.displayRectBox.height*magnify,radius,radius,radius,radius);drawContext.clip();drawContext.setTransform(1,0,0,1,vimg.position.x*magnify,vimg.position.y*magnify);drawContext.drawImage(vimg.image,0,0,vimg.naturalWidth,vimg.naturalHeight);drawContext.restore();var zoom=outputCanvas.width/_Private.displayRectBox.width;outputContext.drawImage(drawCanvas,(outputCanvas.width-s.width*zoom)/2,(outputCanvas.height-s.height*zoom)/2,s.width*zoom,s.height*zoom);return outputCanvas.toDataURL('image/'+s.clippingImportSuffix)},isEventTargettovImageList:function(){var s=ImageView;var isDisplay=false;var target=event.target;var currentTarget=event.currentTarget;if(s.vImageList.length===1){var vimgTarget=s.vImageList[0].target;if(vimgTarget===currentTarget||vimgTarget===target){isDisplay=true}}else if(s.vImageList.length>1){if(isType(s.selector,'string')){if(s.isFindTargettoImageList){s.vImageList.every(function(item,i){if(item.target===target){s.page=i+1;return!(isDisplay=true)}return true})}else{isDisplay=true}}else{isDisplay=true}}return isDisplay},clippingMaskAdaptContainerSize:function(){var s=ImageView;var zoom=1;var ratio=s.clippingWidth/s.clippingHeight;var width=s.width;var height=width/ratio;if(height>s.height){height=s.height;width=height*ratio}zoom=width/s.clippingWidth;_Private.displayRectBox.x=Math.round((s.width-width)/2);_Private.displayRectBox.y=Math.round((s.height-height)/2);_Private.displayRectBox.width=Math.round(width);_Private.displayRectBox.height=Math.round(height);_Private.displayRectBox.clippingRadius=s.clippingRadius*zoom},checkboxsEvent:function(){var target=event&&event.currentTarget;if(target){if(target.hasClass('iv_checkboxs')){var iv_checkboxs=target}else{var iv_checkboxs=target.querySelector('.iv_checkboxs');if(!iv_checkboxs){return}}var checked=iv_checkboxs.getAttribute('data-checked');if(checked==='true'){iv_checkboxs.setAttribute('data-checked',false)}else{iv_checkboxs.setAttribute('data-checked',true)}}}};_Private.init()})();